import{a as w,j as s,y as B,a5 as H,Y as O,d as _,a6 as U,a7 as q,c as V,u as W}from"./index-BmTDuvZb.js";import{L as Y}from"./Logo-IF-9I2F4.js";import{A as K}from"./Alert--W8fVvZR.js";import{I as k}from"./FormContainer-DAIJ54eo.js";import{B as $}from"./Button-DurQkwM5.js";import{u as z,F as G,a as L,C as E,t as J,o as Q,s as I}from"./types-CS3IvESl.js";import{i as X,j as Z}from"./CloseButton-DJjxVEoc.js";import{A as C}from"./ActionLink-BTka9GBU.js";import{u as M}from"./useTimeOutMessage-BrPhzz9b.js";import"./classNames-1IIsPMBF.js";import"./StatusIcon-DsewrCSG.js";import"./isNil-pXqcj5Hj.js";const D=a=>{const{onVisibleChange:n,ref:l,...t}=a,[r,m]=w.useState("password"),c=o=>{o.preventDefault();const d=r==="password"?"text":"password";m(d),n==null||n(d==="text")};return s.jsx(k,{...t,ref:l,type:r,suffix:s.jsx("span",{className:"cursor-pointer select-none text-xl",role:"button",onClick:c,children:r==="password"?s.jsx(X,{}):s.jsx(Z,{})})})},ee=Q({username:I({required_error:"Please enter your email or phone number"}).min(1,{message:"Please enter your email or phone number"}).refine(a=>/\S+@\S+\.\S+/.test(a)||/^[0-9]{10,15}$/.test(a),{message:"Enter a valid email or phone number"}),password:I({required_error:"Please enter your password"}).min(1,{message:"Please enter your password"})}),se=a=>{var y,v,S;const[n,l]=w.useState(!1),t=B();H();const r=w.useRef(null),{disableSubmit:m=!1,className:c,setMessage:o,passwordHint:d}=a,{loginSuccessfully:A}=O(),{handleSubmit:F,formState:{errors:u},control:b}=z({defaultValues:{username:"",password:""},resolver:J(ee)}),R=()=>{var h;const i=window.location.search,f=new URLSearchParams(i).get(q);(h=r.current)==null||h.navigate(f||V.authenticatedEntryPath)},T=async i=>{var h,N,P;const{username:p,password:f}=i;if(!m){l(!0);try{console.log(p,f);const e=(await U.login({username:p,password:f})).data;if(console.log(e),e.success===!1&&e.codeName==="not-verified"){const x=(e==null?void 0:e.phone)||p,j=(e==null?void 0:e.email)||null;t("/otp-verification",{state:{phone:x,email:j}});return}if(e.success===!0&&e.token){o==null||o("Login successful");const x={...e.user,authority:[(h=e.user)==null?void 0:h.type]};await A({token:e.token,user:x}),R()}else o==null||o(e.message||"Login failed")}catch(g){const e=(N=g==null?void 0:g.response)==null?void 0:N.data;if(((P=g.response)==null?void 0:P.status)===401)if((e==null?void 0:e.codeName)==="not-verified"){const x=(e==null?void 0:e.phone)||p,j=(e==null?void 0:e.email)||null;t("/otp-verification",{state:{phone:x,email:j}})}else o==null||o("Wrong username or password.");else o==null||o((e==null?void 0:e.message)||"Login failed. Please try again.")}finally{l(!1)}}};return s.jsx("div",{className:c,children:s.jsxs(G,{onSubmit:F(T),children:[s.jsx(L,{label:"Email or Phone",invalid:!!u.username,errorMessage:(y=u.username)==null?void 0:y.message,children:s.jsx(E,{name:"username",control:b,render:({field:i})=>s.jsx(k,{type:"text",placeholder:"Email or Phone",autoComplete:"off",...i})})}),s.jsx(L,{label:"Password",invalid:!!u.password,errorMessage:(v=u.password)==null?void 0:v.message,className:_(d&&"mb-0",((S=u.password)==null?void 0:S.message)&&"mb-8"),children:s.jsx(E,{name:"password",control:b,render:({field:i})=>s.jsx(D,{type:"password",placeholder:"Password",autoComplete:"off",...i})})}),d,s.jsx($,{className:"block",loading:n,variant:"solid",type:"submit",children:n?"Logging in...":"Login"})]})})},oe=({signUpUrl:a="/sign-up",forgetPasswordUrl:n="/forgot-password",disableSubmit:l})=>{const[t,r]=M(),m=W(c=>c.mode);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"mb-8",children:s.jsx(Y,{type:"streamline",mode:m,imgClass:"mx-auto",logoWidth:60})}),s.jsxs("div",{className:"mb-10",children:[s.jsx("h2",{className:"mb-2",children:"Hamasa Analytics Login"}),s.jsx("p",{className:"font-semibold heading-text",children:"Please enter your credentials to sign in!"})]}),t&&s.jsx(K,{showIcon:!0,className:"mb-4",type:"danger",children:s.jsx("span",{className:"break-all",children:t})}),s.jsx(se,{disableSubmit:l,setMessage:r,passwordHint:s.jsx("div",{className:"mb-7 mt-2",children:s.jsx(C,{to:n,className:"font-semibold heading-text mt-2 underline",themeColor:!1,children:"Forgot password"})})}),s.jsxs("div",{className:"text-center",children:["Do have an account?",s.jsx(C,{to:a,className:"text-bold p-1 underline font-bold heading-text mt-2",themeColor:!1,children:"Sign up"})]})]})},he=()=>s.jsx(oe,{});export{oe as SignInBase,he as default};
