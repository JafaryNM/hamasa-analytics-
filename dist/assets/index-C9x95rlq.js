import{a5 as I,a as r,y as k,j as s,a6 as A}from"./index-BmTDuvZb.js";import{A as v}from"./Alert--W8fVvZR.js";import{B as C}from"./Button-DurQkwM5.js";import{I as y}from"./FormContainer-DAIJ54eo.js";import{O as L}from"./OtpInput-BHfbChDr.js";import{u as G,F as H,a as m,C as l,t as V,o as _,s as d}from"./types-CS3IvESl.js";import{A as q}from"./ActionLink-BTka9GBU.js";import{S as c}from"./index-Dp3eu27c.js";import"./classNames-1IIsPMBF.js";import"./StatusIcon-DsewrCSG.js";import"./CloseButton-DJjxVEoc.js";import"./isNil-pXqcj5Hj.js";const p=6,z=_({otp:d().length(p,{message:"Enter a valid OTP"}),password:d().min(8,"Password must be at least 8 characters"),passwordConfirmation:d().min(8,"Confirm Password must be at least 8 characters")}).refine(a=>a.password===a.passwordConfirmation,{message:"Passwords do not match",path:["passwordConfirmation"]}),ts=()=>{var x,f,j,P;(x=I().state)==null||x.phone;const[g,h]=r.useState(!1),[u,o]=r.useState(null),[w,N]=r.useState(null),[n,T]=r.useState(0),F=k(),{handleSubmit:E,formState:{errors:t},control:i,getValues:M}=G({resolver:V(z)}),O=()=>{const e=M("otp");if(!e||e.length!==p){o("Please enter a valid OTP.");return}o(null),T(1)},R=async e=>{var b,S;h(!0),o(null);try{await A.resendForgotPasswordToken({token:e.otp,password:e.password,passwordConfirmation:e.passwordConfirmation}),N("Password reset successful! Redirecting to sign-in..."),setTimeout(()=>{F("/sign-in")},3e3)}catch(B){o(((S=(b=B.response)==null?void 0:b.data)==null?void 0:S.message)||"Something went wrong.")}h(!1)};return s.jsxs("div",{className:"mx-auto mt-6 bg-white p-6",children:[u&&s.jsx("div",{className:"mb-4",children:s.jsx(v,{type:"danger",children:u})}),w&&s.jsx("div",{className:"mb-4",children:s.jsx(v,{type:"success",children:w})}),s.jsx("h2",{className:"text-center text-lg font-semibold mb-4",children:"Reset Password"}),s.jsxs(c,{current:n,children:[s.jsx(c.Item,{title:"Enter OTP"}),s.jsx(c.Item,{title:"Reset Password"})]}),s.jsxs(H,{className:"mt-10",onSubmit:E(R),children:[n===0&&s.jsxs(s.Fragment,{children:[s.jsx(m,{invalid:!!t.otp,errorMessage:(f=t.otp)==null?void 0:f.message,children:s.jsx(l,{name:"otp",control:i,render:({field:e})=>s.jsx(L,{length:p,...e})})}),s.jsx(C,{variant:"solid",type:"button",onClick:O,children:"Next"})]}),n===1&&s.jsxs(s.Fragment,{children:[s.jsx(m,{label:"New Password",invalid:!!t.password,errorMessage:(j=t.password)==null?void 0:j.message,children:s.jsx(l,{name:"password",control:i,render:({field:e})=>s.jsx(y,{type:"password",placeholder:"Enter new password",...e})})}),s.jsx(m,{label:"Confirm Password",invalid:!!t.passwordConfirmation,errorMessage:(P=t.passwordConfirmation)==null?void 0:P.message,children:s.jsx(l,{name:"passwordConfirmation",control:i,render:({field:e})=>s.jsx(y,{type:"password",placeholder:"Confirm password",...e})})}),s.jsx(C,{loading:g,variant:"solid",type:"submit",children:g?"Resetting Password...":"Reset Password"})]})]}),s.jsxs("div",{className:"mt-4 text-center",children:[s.jsx("span",{children:"Back to "}),s.jsx(q,{to:"/sign-in",className:"heading-text font-bold",themeColor:!1,children:"Sign in"})]})]})};export{ts as default};
