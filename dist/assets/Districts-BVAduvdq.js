import{Y as ee,a as p,ac as re,j as e,a9 as te}from"./index-BmTDuvZb.js";import{T}from"./index-BADhTaSU.js";import{i as oe,j as B,k as ae,l as se}from"./Drawer-DzqlIjEr.js";import{u as ne}from"./useData-BOaL--7C.js";import{A as ie}from"./AdaptiveCard-CrXiXQ44.js";import{N as f}from"./Notification-tU2EwgzP.js";import{t as x}from"./toast-GyZEIVmG.js";import{h as le}from"./moment-BLMuvzoS.js";import{I as de}from"./FormContainer-DAIJ54eo.js";import"./index-DiLTFOK_.js";import{C as ce}from"./ConfirmDialog-teBenfrx.js";import"./FileItem-DzXY3F8e.js";import{S as me}from"./Select-BSoHUsjb.js";import{D as pe}from"./DebouceInput-CO8iQz0e.js";import"./debounce-BDIv-DRu.js";import"./Badge-CndVQ9ZH.js";import{B as C}from"./Button-DurQkwM5.js";import{D as ue}from"./Dialog-DLr3sM2V.js";import{o as F,s as w,u as ge,t as he,F as fe,a as I,C as A}from"./types-CS3IvESl.js";import"./index-Kv-3TB7K.js";import"./index-B2aNPlXf.js";import"./index-Dp3eu27c.js";import{d as y}from"./districtService-BGGYNqv0.js";import{r as xe}from"./regionService-CRbPoQHE.js";import{R as b,C as j}from"./row-BhmCD8Yc.js";import{F as je,P as Ce}from"./Table-D5q3gGnO.js";import"./isNil-pXqcj5Hj.js";import"./CloseButton-DJjxVEoc.js";import"./classNames-1IIsPMBF.js";import"./index-D_KHXJS9.js";import"./Card-BgjqMMuG.js";import"./StatusIcon-DsewrCSG.js";import"./toConsumableArray-BwQuJZQe.js";import"./apiService-CUP-TZv2.js";import"./context-Du5Tb9SW.js";import"./useBreakpoint-B4e-Cr1A.js";import"./extendsObject-BwUYxLSG.js";import"./index-D8WFQQX-.js";import"./Compact-BRfsaHnR.js";import"./AntdIcon-Bbd_N7Ky.js";import"./omit-B089rQxj.js";import"./EllipsisOutlined-BvS74-YI.js";import"./getAllowClear-TCr_opQ2.js";import"./useVariants-D5R8gtcG.js";const we=()=>ne("/districts"),ye=F({name:w().trim().min(1,"Name of district is required"),region:F({label:w().min(1,"Region is required"),value:w().min(2,"Invalid region")})}),pr=()=>{var R,k,P;const{signOut:E}=ee(),{data:Y,total:u,isLoading:U,pagination:o,setPagination:c,authenticated:q}=we(),[z,O]=p.useState(""),[t,n]=p.useState({record:null,isCreate:!0,loading:!1,showModal:!1}),[i,m]=p.useState({record:null,loading:!1,showModal:!1}),{control:S,reset:g,handleSubmit:K,formState:{errors:h}}=ge({resolver:he(ye)}),[L,_]=p.useState([]);p.useEffect(()=>{const{request:r,cancel:s}=xe.list({page:1,perPage:1e5});return r.then(a=>{const l=a.data.data;_(l!=null?l.map(d=>({label:d.name,value:d.uuid})):[])}).catch(a=>{a instanceof re||console.log(a)}),()=>s()},[]);const v=()=>{g({name:"",region:{}})},H=()=>{v(),n({...t,record:null,isCreate:!0,showModal:!0})},V=()=>{v(),n({...t,record:null,isCreate:!0,showModal:!1})},W=r=>{g({name:r.name,region:{label:r.region.name,value:r.region.uuid}}),n({...t,record:r,isCreate:!1,showModal:!0})},G=r=>{if(n({...t,loading:!0}),t.isCreate){const s={...r,regionUuid:r.region.value};y.create(s).then(a=>{g(),n({record:null,loading:!1,isCreate:!0,showModal:!1}),c({...o,page:1}),x.push(e.jsx(f,{title:"Success",type:"success",children:"Record has been created successfully"}))}).catch(a=>{var l,d;x.push(e.jsx(f,{title:"Failed",type:"danger",children:((d=(l=a.response)==null?void 0:l.data)==null?void 0:d.message)||"Something went wrong, try again"})),n({...t,loading:!1})})}else{const s={...r,regionUuid:r.region.value,uuid:t.record!=null?t.record.uuid:""};y.update(s).then(a=>{g(),n({record:null,loading:!1,isCreate:!0,showModal:!1}),c({...o,page:1}),x.push(e.jsx(f,{title:"Success",type:"success",children:"Record has been updated successfully"}))}).catch(a=>{var l,d;x.push(e.jsx(f,{title:"Failed",type:"danger",children:((d=(l=a.response)==null?void 0:l.data)==null?void 0:d.message)||"Something went wrong, try again"})),n({...t,loading:!1})})}},J=()=>{var r;m({...i,loading:!0}),y.delete(((r=i.record)==null?void 0:r.uuid)??"").then(s=>{m({record:null,loading:!1,showModal:!1}),c({...o,page:1})}).catch(s=>{m({...i,loading:!1})})};q||E();const D=()=>{m({...i,record:null,showModal:!1})},Q=r=>{m({...i,record:r,showModal:!0})},N=()=>o.perPage*(o.page-1),X=()=>{let r=N()+o.perPage;return u<r&&(r=u),r},Z=r=>{c({...o,page:r})},M=()=>{c({...o,page:1,search:z})},$=[{title:"S/n",dataIndex:"s_no",key:"s_no",render:(r,s,a)=>(o.page-1)*o.perPage+a+1},{title:"Name",dataIndex:"name",key:"name"},{title:"Region",dataIndex:"region",key:"region",render:r=>r.name},{title:"Created At",dataIndex:"createdAt",key:"createdAt",render:r=>le(r).format("DD MMM YYYY")},{title:"Action",dataIndex:"action",key:"action",render:(r,s)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(T,{wrapperClass:"flex",title:"View",children:e.jsx("span",{className:"cursor-pointer p-2 text-warning",onClick:()=>W(s),children:e.jsx(ae,{size:20})})}),e.jsx(T,{wrapperClass:"flex",title:"Delete",children:e.jsx("span",{className:"cursor-pointer p-2 text-red-500 hover:text-red-500",onClick:()=>Q(s),children:e.jsx(se,{size:20})})})]})}];return e.jsx(te,{children:e.jsx(ie,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsx("h3",{children:"Districts"}),e.jsx(C,{variant:"solid",icon:e.jsx(oe,{className:"text-xl"}),onClick:H,children:"Add new"})]}),e.jsx(b,{className:"mt-5",children:e.jsx(j,{span:24,children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6",children:[e.jsx(pe,{placeholder:"Search",suffix:e.jsx(B,{className:"text-lg"}),onChange:r=>O(r.target.value),onKeyDown:r=>r.key==="Enter"&&M()}),e.jsx(C,{icon:e.jsx(B,{}),onClick:()=>M(),children:"Search"})]})})}),e.jsx(b,{className:"mt-5",children:e.jsx(j,{span:24,children:e.jsx(je,{dataSource:Y,columns:$,rowKey:"uuid",loading:U,pagination:!1})})}),e.jsxs(b,{className:"mt-4",children:[e.jsx(j,{sm:24,md:12,children:e.jsxs("p",{className:"category",children:["Showing ",N()+1," to ",X()," of ",u," ","entries"]})}),e.jsx(j,{sm:24,md:12,children:e.jsx(Ce,{align:"end",current:o.page,total:u,pageSize:o.perPage,onChange:Z})})]}),e.jsxs(ue,{isOpen:t.showModal,onClose:V,children:[e.jsx("h4",{className:"mb-4 text-center",children:t.isCreate?"Create District":"Update District"}),e.jsxs(fe,{onSubmit:K(G),children:[e.jsx(I,{label:"Name",invalid:!!h.name,errorMessage:(R=h.name)==null?void 0:R.message,children:e.jsx(A,{name:"name",control:S,render:({field:r})=>e.jsx(de,{type:"text",placeholder:"Name",autoComplete:"off",...r})})}),e.jsx(I,{label:"Region",invalid:!!h.region,errorMessage:(k=h.region)==null?void 0:k.message,children:e.jsx(A,{name:"region",control:S,render:({field:r})=>e.jsx(me,{placeholder:"Select Region",options:L,...r})})}),e.jsx(C,{loading:t.loading,variant:"solid",type:"submit",children:t.isCreate?"Create":"Update"})]})]}),e.jsx(ce,{isOpen:i.showModal,type:"danger",title:"Warning",confirmText:"Delete",cancelButtonProps:{variant:"solid",color:"default",customColorClass:()=>"text-dark bg-gray-200 hover:bg-default mr-3"},confirmButtonProps:{variant:"solid",color:"danger",customColorClass:()=>"text-white bg-error hover:bg-error",loading:i.loading},onClose:D,onCancel:D,onConfirm:J,children:e.jsxs("p",{children:[" ","This action is irreversible! Deleting"," ",e.jsxs("span",{className:"font-semibold",children:[(P=i.record)==null?void 0:P.name," "]}),"will permanently remove it from the system. Are you sure you want to proceed?"]})})]})})})};export{pr as default};
