import{aQ as V,a as n,a5 as z,ac as Q,j as e,aR as _}from"./index-BmTDuvZb.js";import{h as H}from"./moment-BLMuvzoS.js";import{s as K}from"./Drawer-DzqlIjEr.js";import{a as W}from"./applicationService-RqaSRVra.js";import{a as X}from"./awardApplicationScoreService-ZyD8A1AC.js";import{o as L,e as Z,s as b,g as ee,u as se,t as re,j as ae,F as te,a as P,C as U}from"./types-CS3IvESl.js";import{C as w}from"./Card-BgjqMMuG.js";import{D as ie}from"./Dialog-DLr3sM2V.js";import"./index-BADhTaSU.js";import"./Badge-CndVQ9ZH.js";import{B as oe}from"./Button-DurQkwM5.js";import"./FileItem-DzXY3F8e.js";import{I as E}from"./FormContainer-DAIJ54eo.js";import"./index-Kv-3TB7K.js";import"./index-B2aNPlXf.js";import{N as k}from"./Notification-tU2EwgzP.js";import"./index-Dp3eu27c.js";import{T as le}from"./Tag-CnLXc3pt.js";import{t as q}from"./toast-GyZEIVmG.js";import{a as de}from"./awardService-Bn5RyqjY.js";import"./CloseButton-DJjxVEoc.js";import"./apiService-CUP-TZv2.js";import"./classNames-1IIsPMBF.js";import"./isNil-pXqcj5Hj.js";import"./index-D_KHXJS9.js";import"./StatusIcon-DsewrCSG.js";const ne=L({label:b().optional(),awardCriteriaUuid:b().optional(),score:ee().min(1,"Minimum score is 1").max(10,"Maximum score is 10"),comments:b().min(2,"Comments is required")}),ce=L({judgeReviews:Z(ne).nonempty("Reviews are required")}),me=o=>{var x;const l=(x=o.split(".").pop())==null?void 0:x.toLowerCase();return l?["jpg","jpeg","png","gif","bmp","webp"].includes(l)?"image":["mp4","avi","mov","mkv","wmv"].includes(l)?"video":["pdf"].includes(l)?"pdf":"file":"file"},ue=({attachment:o})=>{const[l,x]=n.useState(null),[d,s]=n.useState(1),[j,c]=n.useState(!1),m=me(o.url);return m==="image"?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:o.url,alt:"Attachment",className:"w-full h-auto object-cover rounded-md cursor-pointer",onClick:()=>c(!0)}),e.jsx(ie,{isOpen:j,onClose:()=>c(!1),children:e.jsx("div",{className:"p-4 flex justify-center",children:e.jsx("img",{src:o.url,alt:"Preview",className:"max-w-md rounded-lg"})})})]}):m==="video"?e.jsxs("video",{controls:!0,className:"w-full h-40 rounded-md",children:[e.jsx("source",{src:o.url,type:"video/mp4"}),"Your browser does not support the video tag."]}):m==="pdf"?e.jsx("div",{className:"border rounded-lg p-3 shadow-md bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"text-center mt-2",children:[e.jsxs("p",{children:["Page ",d," of ",l]}),e.jsx("button",{disabled:d<=1,onClick:()=>s(g=>g-1),className:"text-blue-500 px-2",children:"Prev"}),e.jsx("button",{disabled:d>=(l??1),onClick:()=>s(g=>g+1),className:"text-blue-500 px-2",children:"Next"})]})}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(K,{className:"text-4xl text-blue-500 mb-2"}),e.jsx("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:o.title||"Download File"})]})},$e=()=>{var C,S,R,A;const{uuid:o,applicationUuid:l}=V(),[x,d]=n.useState(!1),[s,j]=n.useState(),[c,m]=n.useState({record:null,isCreate:!0,loading:!1,showModal:!1}),g=z(),I=new URLSearchParams(g.search).get("round")||"",[ge,Y]=n.useState([]),{control:v,reset:N,handleSubmit:B,formState:{errors:p}}=se({resolver:re(ce)}),{fields:$}=ae({control:v,name:"judgeReviews"});n.useEffect(()=>{y(),J()},[]);const y=async()=>{var r,i;d(!0);try{const t=(r=(await W.show(l).request).data)==null?void 0:r.data;t&&j({...t,awardUuid:((i=t.award)==null?void 0:i.uuid)??"",awardRoundUuid:t.awardRoundUuid??""})}catch(a){console.error("Error fetching application:",a)}finally{d(!1)}},J=()=>{d(!0);const{request:r,cancel:i}=de.list({page:1,perPage:1e5},`/criterias/${o}`);r.then(a=>{const t=a.data.data,u=t.map(h=>({label:h.criteria.name,awardCriteriaUuid:h.uuid,score:0,comments:""}));N({judgeReviews:u}),Y(t),d(!1)}).catch(a=>{d(!1),!(a instanceof Q)&&console.log(a)})},O=async r=>{m({...c,loading:!0}),console.log(r);const i={awardUuid:o,applicationUuid:l,awardRoundUuid:I,...r};await X.create(i,"/criteria").then(a=>{y(),N(),m({...c,loading:!1}),q.push(e.jsx(k,{title:"Success",type:"success",children:"Evaluation has been submitted successfully"}))}).catch(a=>{var t,u;q.push(e.jsx(k,{title:"Failed",type:"danger",children:((u=(t=a.response)==null?void 0:t.data)==null?void 0:u.message)||"Something went wrong, try again"})),m({...c,loading:!1})})};return e.jsxs(_,{loading:x,children:[e.jsx("div",{className:"flex flex-col lg:flex-row gap-4",children:e.jsxs("div",{className:"flex-auto flex flex-col gap-4",children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-semibold text-lg",children:"Application Details"}),e.jsx(le,{className:`capitalize ${(s==null?void 0:s.status)==="approved"?"bg-emerald-100 text-emerald-600":(s==null?void 0:s.status)==="rejected"?"bg-red-100 text-red-600":"bg-gray-200 text-gray-700"}`,children:s==null?void 0:s.status})]}),e.jsxs("div",{className:"mt-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Title"}),e.jsx("div",{children:s==null?void 0:s.title})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Description"}),e.jsx("div",{children:s==null?void 0:s.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Published Date"}),e.jsx("div",{children:H(s==null?void 0:s.publishedDate).format("DD MMM YYYY")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Category"}),e.jsx("div",{children:(S=(C=s==null?void 0:s.awardCategory)==null?void 0:C.category)==null?void 0:S.name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Media Channel"}),e.jsx("div",{children:(R=s==null?void 0:s.mediaChannel)==null?void 0:R.name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:"Type"}),e.jsx("div",{children:s!=null&&s.isGroup?"Group Application":"Single Application"})]})]})]})]}),e.jsxs(w,{children:[e.jsx("h4",{className:"mb-4 font-semibold text-lg",children:"Attachment Details"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:(A=s==null?void 0:s.attachments)!=null&&A.length?s.attachments.map(r=>e.jsx("div",{className:"w-[160px]",children:e.jsx(ue,{attachment:r})},r.uuid)):e.jsx("p",{className:"text-gray-500 col-span-full text-center",children:"No attachments found"})})]})]})}),e.jsx(w,{className:"mt-10",children:e.jsxs("div",{className:"",children:[e.jsx("h4",{children:"Application Evaluations"}),e.jsx("div",{className:"mt-8",children:e.jsxs(te,{className:"",onSubmit:B(O),children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:$.map((r,i)=>{var a,t,u,h,D,F,M,T;return e.jsxs("div",{className:"mt-3",children:[e.jsx(P,{label:r.label,invalid:!!((t=(a=p.judgeReviews)==null?void 0:a[i])!=null&&t.score),errorMessage:(h=(u=p.judgeReviews)==null?void 0:u[i])==null?void 0:h.message,children:e.jsx(U,{name:`judgeReviews.${i}.score`,control:v,render:({field:f})=>e.jsx(E,{type:"number",min:1,max:10,placeholder:"Score",autoComplete:"off",value:f.value,onChange:G=>f.onChange(Number(G.target.value))})})}),e.jsx(P,{label:"Comments",invalid:!!((F=(D=p.judgeReviews)==null?void 0:D[i])!=null&&F.comments),errorMessage:(T=(M=p.judgeReviews)==null?void 0:M[i])==null?void 0:T.message,children:e.jsx(U,{name:`judgeReviews.${i}.comments`,control:v,render:({field:f})=>e.jsx(E,{type:"text",placeholder:"Comments",autoComplete:"off",textArea:!0,...f})})})]},r.awardCriteriaUuid)})}),e.jsx(oe,{loading:c.loading,type:"submit",variant:"solid",className:"bg-primary text-white ml-auto col-span-2 mt-10",children:"Submit Review"})]})})]})})]})};export{$e as default};
