import{y as f,a as x,j as e,a6 as j,Y as y,a5 as O}from"./index-BmTDuvZb.js";import{B as T}from"./Button-DurQkwM5.js";import{o as b,s as P,u as v,t as N,F as S,a as F,C as V}from"./types-CS3IvESl.js";import"./FormContainer-DAIJ54eo.js";import{O as E}from"./OtpInput-BHfbChDr.js";import{t}from"./toast-GyZEIVmG.js";import{N as n}from"./Notification-tU2EwgzP.js";import"./classNames-1IIsPMBF.js";import"./isNil-pXqcj5Hj.js";import"./CloseButton-DJjxVEoc.js";import"./StatusIcon-DsewrCSG.js";const A=6,R=b({otp:P().length(A,{message:"Please enter valid otp"})}),L=({phone:d})=>{var l;const g=f(),[i,o]=x.useState(!1),{handleSubmit:m,formState:{errors:p},control:u}=v({resolver:N(R)}),h=async a=>{var c,s;if(!d){t.push(e.jsx(n,{title:"Missing Phone Number",type:"danger",children:"Phone number is missing."}));return}o(!0);try{const r=await j.verifyAccount({phone:d,token:a.otp});r.data.success?(t.push(e.jsx(n,{title:"OTP Verified",type:"success",children:"✅ OTP Verified Successfully! Redirecting to sign-in..."})),localStorage.setItem("redirectAfterLogin","/dashboards/applicants"),setTimeout(()=>{g("/sign-in")},2e3)):t.push(e.jsx(n,{title:"Verification Failed",type:"danger",children:r.data.message||"❌ OTP verification failed."}))}catch(r){t.push(e.jsx(n,{title:"Error",type:"danger",children:((s=(c=r==null?void 0:r.response)==null?void 0:c.data)==null?void 0:s.message)||"❌ Invalid OTP. Try again."}))}finally{o(!1)}};return e.jsxs("div",{className:"mx-auto mt-6",children:[e.jsx("h2",{className:"text-left text-lg font-semibold",children:"Enter OTP"}),e.jsxs(S,{onSubmit:m(h),children:[e.jsx(F,{invalid:!!p.otp,errorMessage:(l=p.otp)==null?void 0:l.message,children:e.jsx(V,{name:"otp",control:u,render:({field:a})=>e.jsx(E,{placeholder:"",inputClass:"h-[58px]",length:OTP_LEGNTH,...a})})}),e.jsx(T,{loading:i,variant:"solid",type:"submit",children:i?"Verifying...":"Verify OTP"})]})]})},B=()=>{var u;const{user:d}=y(),g=O();f();const i=((u=g.state)==null?void 0:u.phone)||"",[o,m]=x.useState(!1);console.log(d);const p=async()=>{var h,l,a,c;if(!i){t.push(e.jsx(n,{title:"Missing Phone",type:"danger",children:"Phone number is missing."}));return}m(!0);try{const s=await j.resendOtp({username:i});((h=s.data)==null?void 0:h.success)===!0?t.push(e.jsx(n,{title:"OTP Sent",type:"success",children:s.data.message||"A new OTP has been sent to your phone."})):t.push(e.jsx(n,{title:"Resend Failed",type:"danger",children:((l=s.data)==null?void 0:l.message)||"Failed to resend OTP."}))}catch(s){t.push(e.jsx(n,{title:"Error",type:"danger",children:((c=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:c.message)||"Error resending OTP. Try again."}))}finally{m(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"mb-2",children:"OTP Verification"}),e.jsxs("p",{className:"font-semibold heading-text",children:["A One Time OTP token has been sent to your phone number:"," ",e.jsx("strong",{children:i})]})]}),e.jsx(L,{phone:i}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsx("span",{className:"font-semibold",children:"Didn't receive OTP? "}),e.jsx("button",{className:"heading-text font-bold underline",onClick:p,disabled:o,children:o?"Resending...":"Resend OTP"})]})]})},q=()=>e.jsx(B,{});export{B as OtpVerificationBase,q as default};
